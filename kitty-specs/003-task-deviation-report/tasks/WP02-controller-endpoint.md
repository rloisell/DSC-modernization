---
work_package_id: "WP02"
title: "API — GET /api/reports/task-deviation endpoint"
lane: "planned"
subtasks:
  - "WP01"
phase: "Phase 1 — API Layer"
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-02-22T03:00:00Z"
    lane: "planned"
    agent: "system"
    action: "Prompt generated by GitHub Copilot spec-kitty session"
---

# Work Package Prompt: WP02 – API — GET /api/reports/task-deviation endpoint

## Context

Expose `GetTaskDeviationAsync` via the `ReportsController`.

## Files to Modify

- `src/DSC.Api/Controllers/ReportsController.cs`

## Steps

1. Add action:
   ```csharp
   // returns task deviation report for the authenticated user's scope
   [HttpGet("task-deviation")]
   public async Task<IActionResult> GetTaskDeviation(
       [FromQuery] DateTime? from,
       [FromQuery] DateTime? to,
       [FromQuery] Guid? projectId)
   ```
2. Extract `callerId` from `X-User-Id` header (existing pattern).
3. Delegate to `_reportService.GetTaskDeviationAsync(from, to, projectId, callerId)`.
4. Return `Ok(result)`.

## Acceptance

- [ ] GET `/api/reports/task-deviation` returns 200 with array
- [ ] Filters `from`, `to`, `projectId` work correctly
- [ ] Returns `[]` (not 404) for users with no work items

