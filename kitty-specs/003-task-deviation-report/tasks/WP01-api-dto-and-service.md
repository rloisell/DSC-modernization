---
work_package_id: "WP01"
title: "API — TaskDeviationDto, IReportService, ReportService"
lane: "planned"
subtasks: []
phase: "Phase 1 — API Layer"
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-02-22T03:00:00Z"
    lane: "planned"
    agent: "system"
    action: "Prompt generated by GitHub Copilot spec-kitty session"
---

# Work Package Prompt: WP01 – API — TaskDeviationDto, IReportService, ReportService

## Context

Add the DTO, interface method, and service implementation for the task deviation report.

## Files to Modify

- `src/DSC.Api/DTOs/ReportDtos.cs`
- `src/DSC.Api/Services/IReportService.cs`
- `src/DSC.Api/Services/ReportService.cs`

## Steps

1. Add `TaskDeviationDto` record (see spec §FR-003-001).
2. Add method signature to `IReportService`:
   ```csharp
   Task<TaskDeviationDto[]> GetTaskDeviationAsync(DateTime? from, DateTime? to, Guid? projectId, Guid? callerId);
   ```
3. Implement in `ReportService`:
   - Query `WorkItems` with `.Include(w => w.Project)`
   - Filter by caller role (User → own items; others → team/all)
   - Apply `from`/`to`/`projectId` filters
   - Compute `DeviationHours` and `DeviationPercent` (null when `Planned == 0`)
   - Order by `DeviationPercent desc nulls last`
4. `dotnet build` — clean.

## Acceptance

- [ ] DTO and interface added
- [ ] Service returns correct data for seeded users
- [ ] Division-by-zero handled gracefully

