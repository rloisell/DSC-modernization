---
work_package_id: "WP01"
title: "DTOs + ReportService — project effort summary and activity area deviation"
lane: "planned"
subtasks: []
phase: "Phase 2 — DTOs and Service"
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-02-22T03:00:00Z"
    lane: "planned"
    agent: "system"
    action: "Prompt generated by GitHub Copilot spec-kitty session"
---

# Work Package Prompt: WP01 – DTOs + ReportService — project effort summary and activity area deviation

## Context

Implement both management report aggregations in `ReportService`.

## Files to Modify

- `src/DSC.Api/DTOs/ReportDtos.cs`
- `src/DSC.Api/Services/IReportService.cs`
- `src/DSC.Api/Services/ReportService.cs`

## Key DTO Shapes

```csharp
public record ProjectEffortSummaryDto(
    Guid ProjectId, string ProjectNo, string ProjectName,
    decimal EstimatedHours, decimal TotalPlannedHours, decimal TotalActualHours,
    decimal? EstimateVsActualPct, decimal? PlannedVsActualPct);

public record ActivityAreaDeviationDto(
    string ActivityCode, string ActivityDescription,
    decimal TotalPlannedHours, decimal TotalActualHours,
    decimal DeviationHours, decimal? DeviationPct);
```

## Steps

1. Add DTOs to `ReportDtos.cs`.
2. Add method signatures to `IReportService`.
3. Implement `GetProjectEffortSummaryAsync`:
   - Join WorkItems → Projects → ProjectAssignments
   - Scope: Manager → caller's DepartmentId; Director/Admin → all
   - Group by Project; aggregate planned/actual; compute percentages (null on zero denominator)
4. Implement `GetActivityAreaDeviationAsync`:
   - Group WorkItems by `ActivityCode`; join to activity catalogue for description
   - Scope same as above
   - Compute `DeviationPct` (null on zero planned)
5. `dotnet build` — clean.

## Acceptance

- [ ] Both DTOs and method signatures added
- [ ] Service returns correct data for seeded users
- [ ] Null-safe percentage calculations

