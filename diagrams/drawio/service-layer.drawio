<mxfile host="app.diagrams.net" modified="2026-02-20T00:00:00.000Z" agent="GitHub Copilot" version="24.5.2">
  <diagram id="service-layer" name="Service Layer Architecture">
    <mxGraphModel dx="1422" dy="762" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1654" pageHeight="1169" math="0" shadow="0" background="#ffffff">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        
        <mxCell id="2" value="DSC Service Layer — Introduced in Modernisation Sprint" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontStyle=1;fontSize=16;" vertex="1" parent="1">
          <mxGeometry x="30" y="10" width="700" height="40" as="geometry" />
        </mxCell>

        
        <mxCell id="10" value="HTTP Layer (Thin Controllers)" style="swimlane;startSize=30;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="70" width="760" height="120" as="geometry" />
        </mxCell>
        <mxCell id="11" value="AuthController&#10;+ Login(req)&#10;+ GetByEmpId(empId)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="10">
          <mxGeometry x="10" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="12" value="ItemsController&#10;+ CallerId: Guid&#10;+ GetAll() / Create()&#10;+ Patch() / Delete()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="10">
          <mxGeometry x="200" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="13" value="ProjectsController&#10;+ GetAll()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="10">
          <mxGeometry x="390" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="14" value="ReportsController&#10;+ GetSummary(...)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=10;" vertex="1" parent="10">
          <mxGeometry x="580" y="40" width="160" height="60" as="geometry" />
        </mxCell>

        
        <mxCell id="20" value="Service Interfaces" style="swimlane;startSize=30;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="240" width="760" height="120" as="geometry" />
        </mxCell>
        <mxCell id="21" value="«interface»&#10;IAuthService&#10;+ AuthenticateAsync()&#10;+ GetByEmpIdAsync()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=2;" vertex="1" parent="20">
          <mxGeometry x="10" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="22" value="«interface»&#10;IWorkItemService&#10;+ GetAllAsync()&#10;+ CreateAsync() / PatchAsync()&#10;+ DeleteAsync()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=2;" vertex="1" parent="20">
          <mxGeometry x="200" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="23" value="«interface»&#10;IProjectService&#10;+ GetAllAsync(userId, isAdmin)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=2;" vertex="1" parent="20">
          <mxGeometry x="390" y="40" width="160" height="60" as="geometry" />
        </mxCell>
        <mxCell id="24" value="«interface»&#10;IReportService&#10;+ GetSummaryAsync(&#10;  from,to,projectId,userId)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;fontStyle=2;" vertex="1" parent="20">
          <mxGeometry x="580" y="40" width="160" height="60" as="geometry" />
        </mxCell>

        
        <mxCell id="30" value="Service Implementations (Scoped)" style="swimlane;startSize=30;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="420" width="760" height="160" as="geometry" />
        </mxCell>
        <mxCell id="31" value="AuthService&#10;- _db: ApplicationDbContext&#10;▶ AuthenticateAsync()&#10;  → throws UnauthorizedException&#10;▶ GetByEmpIdAsync()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="30">
          <mxGeometry x="10" y="40" width="160" height="90" as="geometry" />
        </mxCell>
        <mxCell id="32" value="WorkItemService&#10;- _db: ApplicationDbContext&#10;▶ EnforceOwnershipAsync()&#10;▶ MapToDto()&#10;→ throws NotFoundException&#10;→ throws ForbiddenException" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="30">
          <mxGeometry x="200" y="40" width="160" height="90" as="geometry" />
        </mxCell>
        <mxCell id="33" value="ProjectService&#10;- _db: ApplicationDbContext&#10;▶ GetAllAsync()&#10;  Filter by userId / isAdmin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="30">
          <mxGeometry x="390" y="40" width="160" height="90" as="geometry" />
        </mxCell>
        <mxCell id="34" value="ReportService&#10;- _db: ApplicationDbContext&#10;▶ GetSummaryAsync()&#10;  Privilege check&#10;  Group by project/user" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=10;" vertex="1" parent="30">
          <mxGeometry x="580" y="40" width="160" height="90" as="geometry" />
        </mxCell>

        
        <mxCell id="40" value="Infrastructure" style="swimlane;startSize=30;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="640" width="760" height="150" as="geometry" />
        </mxCell>
        <mxCell id="41" value="GlobalExceptionHandler&#10;«IExceptionHandler»&#10;─────────────────────&#10;NotFoundException → 404&#10;ForbiddenException → 403&#10;BadRequestException → 400&#10;UnauthorizedException → 401&#10;Exception → 500 (logged)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="40">
          <mxGeometry x="10" y="40" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="42" value="DatabaseHealthCheck&#10;«IHealthCheck»&#10;─────────────────────&#10;IServiceScopeFactory&#10;→ db.Database.CanConnectAsync()&#10;→ /health/live, /health/ready&#10;→ /health/details (JSON)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="40">
          <mxGeometry x="260" y="40" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="43" value="DomainExceptions&#10;─────────────────────&#10;NotFoundException (: Exception)&#10;ForbiddenException (: Exception)&#10;BadRequestException (: Exception)&#10;UnauthorizedException (: Exception)&#10;─ primary constructors only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=10;" vertex="1" parent="40">
          <mxGeometry x="510" y="40" width="220" height="90" as="geometry" />
        </mxCell>

        
        <mxCell id="50" value="ApplicationDbContext (EF Core 9)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="30" y="850" width="760" height="60" as="geometry" />
        </mxCell>

        
        
        <mxCell id="c1" value="uses" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="11" target="21" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c2" value="uses" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="12" target="22" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c3" value="uses" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="13" target="23" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c4" value="uses" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="14" target="24" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        
        <mxCell id="c5" value="implements" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=block;endFill=0;strokeWidth=2;" edge="1" source="31" target="21" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c6" value="implements" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=block;endFill=0;strokeWidth=2;" edge="1" source="32" target="22" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c7" value="implements" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=block;endFill=0;strokeWidth=2;" edge="1" source="33" target="23" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c8" value="implements" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=block;endFill=0;strokeWidth=2;" edge="1" source="34" target="24" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        
        <mxCell id="c9" value="" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;" edge="1" source="31" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c10" value="" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;" edge="1" source="32" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c11" value="" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;" edge="1" source="33" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c12" value="" style="edgeStyle=orthogonalEdgeStyle;strokeWidth=2;" edge="1" source="34" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        
        <mxCell id="c13" value="throws" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="31" target="43" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="c14" value="throws" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="32" target="43" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        
        <mxCell id="c15" value="handles → ProblemDetails" style="edgeStyle=orthogonalEdgeStyle;dashed=1;endArrow=open;strokeWidth=2;" edge="1" source="41" target="43" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        
        <mxCell id="c16" value="probes" style="edgeStyle=orthogonalEdgeStyle;dashed=1;strokeWidth=2;" edge="1" source="42" target="50" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>