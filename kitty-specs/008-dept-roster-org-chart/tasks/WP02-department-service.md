---
work_package_id: "WP02"
title: "IDepartmentService + DepartmentService implementation"
lane: "planned"
subtasks:
  - "WP01"
phase: "Phase 2 — Service"
assignee: ""
agent: ""
shell_pid: ""
review_status: ""
reviewed_by: ""
history:
  - timestamp: "2026-02-22T03:00:00Z"
    lane: "planned"
    agent: "system"
    action: "Prompt generated by GitHub Copilot spec-kitty session"
---

# Work Package Prompt: WP02 – IDepartmentService + DepartmentService implementation

## Files to Create

- `src/DSC.Api/Services/IDepartmentService.cs` (new)
- `src/DSC.Api/Services/DepartmentService.cs` (new)

## Steps

1. `IDepartmentService`:
   ```csharp
   Task<DepartmentRosterDto> GetDepartmentRosterAsync(Guid deptId, Guid callerId);
   Task<OrgChartDto> GetOrgChartAsync(Guid callerId);
   ```
2. `DepartmentService.GetDepartmentRosterAsync`:
   - Load calling user's department from DB
   - Role check: User/Manager → deptId must match caller's dept (throw `ForbiddenException` otherwise)
   - Query `Users.Where(u => u.DepartmentId == deptId).Include(u => u.Department)`
   - Identify manager: `u.Role == "Manager"` in the dept
   - Map to `DepartmentMemberDto`; FullName = `$"{u.FirstName} {u.LastName}"` (adjust to actual User model)
   - Return `DepartmentRosterDto`
3. `DepartmentService.GetOrgChartAsync`:
   - Role check: User/Manager → throw `ForbiddenException`
   - Query all departments; for each, build `DepartmentRosterDto`
   - Return `OrgChartDto`
4. Register: `builder.Services.AddScoped<IDepartmentService, DepartmentService>()`
5. `dotnet build` — clean.

## Acceptance

- [ ] User/Manager 403 for wrong department
- [ ] Manager sees full roster
- [ ] Director/Admin see all in org chart
- [ ] `dotnet build` clean

